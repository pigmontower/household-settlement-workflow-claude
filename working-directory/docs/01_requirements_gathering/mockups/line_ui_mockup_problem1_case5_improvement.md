# line_ui_mockup_problem1_case5.html 改善提案書

> このドキュメントは、元のモックファイルの問題点と改善内容を記載しています。

---

## 問題点1: テキストコピペによる再開は技術的に実現困難

### 元ファイルの該当箇所

```html
<div class="message bot">
    処理を中断しました。この明細は精算に加算されません。再開したい場合は、最後に送られたリストをこのトークに送信してください。
</div>
```

```html
<!-- 2. Resume Scenario -->
<div class="message mine">
    スーパーABC
    2025/12/26 10:30
    ----------------
    🤝 品目A：500
    ➡️ 品目B：300
    　 品目C：200
    ----------------
    合計：1,000
</div>
```

### なにが問題か

1. **ステートレス復元の限界**：ユーザーがコピペしたテキストから店名・日時を確実に抽出できない場合がある
2. **品目の一意性**：同じ金額の品目が複数ある場合、テキストだけでは区別できない
3. **n8nの制約**：n8nはリクエストごとにステートレスで動作するため、テキストから完全に状態を復元するのは困難

### 改善内容

「テキストコピペによる再開」機能を廃止し、以下の方式に変更：

1. **セッション管理による自動再開**：24時間以内であればセッションデータから自動的に前回の状態を復元
2. **テキスト送信時は新規入力として処理**：過去のリストを送信した場合は、OCRをスキップして新規入力として扱う

---

## 問題点2: キャンセル後のメッセージが長い

### 元ファイルの該当箇所

```html
<div class="message bot">
    処理を中断しました。この明細は精算に加算されません。再開したい場合は、最後に送られたリストをこのトークに送信してください。
</div>
```

### なにが問題か

メッセージが長く、ユーザーが読み飛ばす可能性がある。

### 改善内容

キャンセル後のメッセージを簡潔にし、セッション管理による再開を案内：

```
処理を中断しました。

24時間以内であれば、新しいレシート画像を送信することで前回の続きから再開できます。
```

---

## 改善後のモック

改善後のUIは `line_ui_mockup_problem1_case5_improvement.html` を参照してください。

主な変更点：
1. 「テキストコピペによる再開」機能を廃止
2. 「セッション管理による自動再開」方式に変更
3. キャンセル後のメッセージを簡潔化
